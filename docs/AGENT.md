# AGENT.md · Meta-Doc

作用
- 作为全仓库的“协作元契约”，统一各目录 AGENT.md 与文件级写作/对话规范。
- 强调“以文件为单位”的协作：先整文件初稿，再逐条/逐章修订；复杂主题用“新增同构文件”分解。
- 不约束推理过程，只约束产出形态与讨论节奏。

适用范围
- 0-governance、1-strategic、2-tactical、3-quality、4-delivery 及其子目录。
- 新增目录/文件时沿用本约定。

通用协作规则
- 单位：以“文件”为产出单位推进。
- 节奏：
  - 首轮产出“整文件初稿”，用于对齐全貌。
  - 迭代阶段“逐条/逐章”修订，每轮只改一个条目或一个章节。
- 输出边界：每轮对话仅输出目标文件或该文件中被点名的条目/章节；禁止整篇覆盖其他内容。
- 变更记录：仅在目标文件末尾的“## 变更”小节追加一行摘要（范围/动机/变更/影响/验证），避免文档膨胀。
- 拆分策略：当文件过长或主题发散，新增同构文件进行分解，并在原文件放置“参见”占位与链接。

文件拆分规范
- 触发条件（任一满足即可）：
  - 文件>150–200行、影响可读性。
  - 一个文件内跨多个上下文/子域、主题内聚性下降。
  - 讨论频繁跨越不相干章节，导致上下文噪音。
- 命名与结构：
  - 同构命名：如 glossary-order.md、use-cases-order.md、contracts-payment.md。
  - 在父目录新增 index.md 作为目录页，列出子文件清单与一句话职责。
- 迁移方式：
  - 将相关章节整体搬迁至新文件，原处保留“参见新文件章节X”的占位。
  - 新文件“## 变更”首条注明“从旧文件迁移”。

抽象验收性质（所有文件适用）
- 一致性：术语统一且可追溯；同一名词不多义。
- 完备性：对适用内容覆盖 Happy path、≥2个异常、1个边界（结构型文件）。
- 可证伪性：关键结论附可被挑战的前提/反例或替代方案占位（不强制证明过程）。
- 可操作性：每个关键结论对接至少1个落地提示（契约字段/测试占位/可观测信号等）。

文件级结果契约（最小规范）
- 列表型文件（术语/约束/风险/决策）
  - glossary.md：每条=术语/定义/正例/反例/易混词；≤6行/条。
  - constraints.md：每条=名称(含类别)/简述/可能影响；≤6行/条。
  - decisions.md：每条=日期/问题/选项/结论/理由/影响；≤10行/条。
  - risks.md：每条=标题/概率/影响/缓解/触发条件；≤8行/条。
- 结构型文件（用例/领域模型/事件/契约）
  - use-cases.md：每用例=前置/主流程/异常(≥2)/边界/结果。
  - domain-model.md：分章节=Aggregates/Entities/ValueObjects；聚合内含 职责/不变量(≥1)/事务边界/对外交互。
  - events.md：每事件=名称/含义/触发/订阅/幂等或顺序关注点(如适用)。
  - contracts.md：以“版本块”为单位=版本/日期/请求/响应/来源用例/可观测信号名。

文件顶部契约（建议写在每个文件开头注释）
- 本文件为[列表型/结构型]。
- 生成节奏：[整文件初稿→逐条/逐章修订]；修订时仅输出目标条目/章节。
- 结果契约：[按本文件的字段/章节结构]。
- 变更记录：仅在“## 变更”追加摘要。

对话使用（Zed）
- 生成初稿：要求仅输出该文件内容，遵循文件契约。
- 精修：复制目标条目/章节到对话中，要求仅输出该条/章修订版。
- 扩展：当触发拆分条件，新增同构文件并移动相关章节。

注意
- 过程追踪（需求/任务/PR）留在外部系统；本仓库只承载“被认可的当前设计”和必要的就地变更摘要。
- 高风险决策（如分布式事务/安全架构）可在对应目录的 AGENT.md 增加“必须包含的证据类型或最小原型占位”，但仍以结果契约呈现。
