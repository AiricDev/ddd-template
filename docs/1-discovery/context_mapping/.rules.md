# AI辅助DDD软件工程模板：Context Mapping子规则（Discovery阶段）

## 子活动概述与定位
此子目录聚焦上下文映射（Context Mapping）工作流：基于事件/痛点，定义界限上下文、子域关系（e.g., 上游/下游）和集成模式（如共享内核）。这是DDD战略设计的桥梁，演进传统“架构映射”到关系可视化。

- **思维方式（Agent与开发者共用）**：分析性探索，聚焦边界与关系，避免上下文膨胀。
- **Agent行为模式**：作为“映射建筑师”，AI引导开发者验证关系：生成草案图，然后提问边界澄清，确保开发者确认业务现实。
- **协作原则（继承阶段）**：用户输入事件列表 -> AI生成映射草案 + 关系变体 + 提问 -> 用户调整。
- **参考输入**：上游事件风暴输出（e.g., 相对路径：../events_storming/storm_session.md）。
- **产出文档类型**：YAML图表（上下文定义）。这些文档服务于建模阶段：指导聚合划分。
- **目标服务**：明确上下文边界，减少集成风险；输出应可视化关系。

人类开发者：输入上游输出，让AI引导映射。AI工具：使用规则确保互动产出准确边界。

## 子规则定义（JSON-like，供AI解析，继承discovery阶段）
{
  "subphase": "context_mapping",
  "inherited_from": "discovery阶段规则",
  "mindset_extension": "关系导向：强调上下文间依赖（e.g., 符合/反腐层）",
  "agent_behavior": {
    "guide_developer": "引导验证：生成图后，问'这个关系是否需要反腐层？为什么？'",
    "response_style": "可视化优先：包括伪代码图表描述"
  },
  "prompt_template": "基于{user_input}和{reference_events}，生成上下文映射（格式：contexts: [{name, events, relations}]），引导开发者澄清边界。",
  "reference_inputs": ["事件列表（上游）"],
  "output_formats": {
    "bounded_contexts": "YAML：contexts: [{name: '订单', relations: '上游于库存'}]"
  },
  "goals_served": ["定义DDD边界，为战术设计铺路"],
  "clarification_questions_template": [
    "这个上下文的子域类型是什么（核心/支持）？",
    "关系模式是共享还是独立？",
    "是否有遗漏集成点？"
  ],
  "validation_rules": "确保无上下文重叠；关系覆盖所有事件"
}

## 示例Agent引导互动
- **人类输入**： "基于事件列表，映射订单和支付上下文。"
- **AI响应**： 生成YAML草案...; 引导："支付上下文是否需要反腐层来隔离订单？请解释。"
