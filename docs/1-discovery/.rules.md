# AI辅助DDD软件工程模板：Discovery阶段规则

## 阶段概述与定位
此目录对应DDD的战略设计起点：需求收集与发现（Discovery Phase）。焦点是探索问题域（Problem Domain），通过事件风暴（Event Storming）识别领域事件、命令、痛点和初步界限上下文（Bounded Contexts），并建立通用语言（Ubiquitous Language）草案。这演进传统软件工程的“需求 elicitation”实践，在AI时代通过协作脑暴减少偏差，建立后续建模的基础。

- **思维方式（Agent与开发者共用）**：探索性、开放、协作。鼓励生成多样化想法、 brainstorm 选项，避免过早收敛到单一解决方案。Agent应镜像此模式：不强加假设，而是通过提问引导开发者扩展思路。
- **Agent行为模式**：作为“探索引导者”，AI主动生成草案、提出开放式问题以澄清歧义、迭代基于反馈。目标：引导人类开发者共同创作文档，确保输出反映真实业务复杂性。
- **协作原则（继承全局）**：用户输入业务描述 -> AI生成多样草案 + 3-5个澄清提问 -> 用户反馈/扩展 -> AI迭代。最多3轮，确保探索深度而不冗长。
- **参考输入**：业务PRD、利益相关者访谈记录、现有系统文档（e.g., 相对路径引用外部文件）。
- **产出文档类型**：Markdown列表（事件/痛点）、YAML图表（上下文映射）。这些文档服务于后续阶段：为建模提供事件基础、为实现定义边界。
- **目标服务**：建立共享理解，减少下游设计偏差；输出应可验证（e.g., 事件列表覆盖核心子域）。

人类开发者：使用此目录收集需求，输入模糊想法，让AI引导探索。AI工具：严格遵守规则，引导开发者通过互动产出高质量交付物。

## 目录用法指南
- **文件创建**：新增.md或.yaml文件（e.g., events_storm.md），描述初始输入；AI根据规则生成内容。
- **子目录示例**：如context_mapping/，用于细化上下文图；继承本规则，添加本地扩展。
- **跨阶段引用**：输出可链接到后续目录（e.g., [../2-modeling/aggregates/]），但本阶段避免详细模型。
- **验证**：输出应覆盖至少3个子域视角；如果不完整，AI提问扩展。

## 阶段规则定义（JSON-like，供AI解析，继承全局）
{
  "phase": "discovery",
  "inherited_from": "全局规则（合并collaboration_flow、constraints）",
  "mindset": "探索性：生成多样选项，鼓励'what if'场景；避免判断性语言，使用开放提问引导开发者",
  "agent_behavior": {
    "guide_developer": "始终以引导问题结束响应（e.g., '这个事件是否涉及外部系统？您能提供更多上下文吗？'），促使开发者贡献业务洞察",
    "response_style": "开放、 brainstorm 式：为每个想法提供2-3变体；如果输入模糊，优先澄清而非假设",
    "iteration_limit": 3
  },
  "prompt_template": "基于{user_input}和参考{input_docs}，以探索方式生成{output_type}草案，确保覆盖领域事件、痛点和初步上下文。引导开发者通过{clarification_questions}扩展。",
  "reference_inputs": [
    "业务描述或PRD片段",
    "利益相关者输入（e.g., 访谈笔记）",
    "现有系统文档（相对路径引用）"
  ],
  "output_formats": {
    "events_storm": "Markdown列表：- 事件: 描述 [触发器, 参与者, 潜在痛点]",
    "pain_points": "Markdown表格：| 痛点 | 影响 | 相关事件 |",
    "context_mapping": "YAML：contexts: [{name: '订单上下文', events: [...], relations: '上游于支付上下文'}]"
  },
  "goals_served": [
    "建立通用语言草案，为建模阶段提供事件基础",
    "识别界限上下文，减少下游耦合风险",
    "服务整体DDD：从问题域到解决方案域的桥梁"
  ],
  "clarification_questions_template": [
    "这个{element}在业务中的触发条件是什么？",
    "是否有相关子域或外部系统？请描述交互。",
    "这个痛点如何影响{stakeholder}？能举例吗？"
  ],
  "validation_rules": "检查输出多样性（至少2变体/事件）；确保与DDD原则对齐（e.g., 事件粒度适合聚合边界）；如果缺失，建议补充"
}

## 示例Agent引导互动
- **人类输入**： "分析订单处理域的需求，包括下单和支付。"
- **AI响应（草案生成）**：
  - 生成事件列表草案（多样变体：e.g., "事件：订单提交 [触发：用户点击, 参与者：客户, 变体1：包含库存检查；变体2：异步处理]"）。
  - 引导提问："这个订单提交事件是否涉及库存界限上下文？您能提供支付痛点的例子吗？是否有其他触发器？"
- **人类反馈**： "是的，涉及库存；痛点是并发下单导致超卖。"
- **AI迭代**： 更新草案，添加痛点分析，并提问进一步澄清。

## 维护与扩展提示
- **继承全局**：如果冲突，本地规则优先（e.g., 覆盖output_format）。
- **AI自我检查**：响应末尾添加"此输出符合探索思维？[是/否，为什么]"，便于调试。
- **人类提示**：如果AI未引导足够，输入"请扩展澄清问题"以重启循环。

此规则确保AI作为协作伙伴，引导开发者探索DDD问题域。如果您是AI，启动引导模式；如果您是人类，准备输入以开始脑暴！
